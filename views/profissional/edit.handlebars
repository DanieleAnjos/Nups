{{!-- views/profissional/edit.handlebars --}}

<h2>Editar Profissional</h2>
<form action="/profissionais/{{profissional.id}}?_method=PUT" method="POST">
    <label for="nome">Nome:</label>
    <input type="text" name="nome" value="{{profissional.nome}}" required>
    
    <label for="email">Email:</label>
    <input type="email" name="email" value="{{profissional.email}}" required>
    
    <label for="matricula">Matrícula:</label>
    <input type="number" name="matricula" value="{{profissional.matricula}}" required>
    
    <label for="dataAdmissao">Data de Admissão:</label>
    <input type="date" name="dataAdmissao" value="{{profissional.dataAdmissao}}" required>
    
    <label for="cargo">Cargo:</label>
    <select name="cargo" required>
        <option value="Assistente social" {{#if (eq profissional.cargo "Assistente social")}}selected{{/if}}>Assistente social</option>
        <option value="Administrador" {{#if (eq profissional.cargo "Administrador")}}selected{{/if}}>Administrador</option>
        <option value="Psicólogo" {{#if (eq profissional.cargo "Psicólogo")}}selected{{/if}}>Psicólogo</option>
        <option value="Psiquiatra" {{#if (eq profissional.cargo "Psiquiatra")}}selected{{/if}}>Psiquiatra</option>
    </select>
    
    <label for="vinculo">Vínculo:</label>
    <select name="vinculo" required>
        <option value="Servidor" {{#if (eq profissional.vinculo "Servidor")}}selected{{/if}}>Servidor</option>
        <option value="Voluntario" {{#if (eq profissional.vinculo "Voluntario")}}selected{{/if}}>Voluntário</option>
    </select>

    <label for="cpf">CPF:</label>
    <input type="text" name="cpf" value="{{profissional.cpf}}" required pattern="\d{11}" title="Deve conter 11 dígitos.">

    <label for="dataNascimento">Data de Nascimento:</label>
    <input type="date" name="dataNascimento" value="{{profissional.dataNascimento}}" required>

    <label for="sexo">Sexo:</label>
    <input type="text" name="sexo" value="{{profissional.sexo}}" required>

    <label for="cep">CEP:</label>
    <input type="text" name="cep" value="{{profissional.cep}}" required pattern="\d{8}" title="Deve conter 8 dígitos" id="cep">

    <label for="endereco">Endereço:</label>
    <input type="text" name="endereco" value="{{profissional.endereco}}" required id="endereco">

    <label for="bairro">Bairro:</label>
    <input type="text" name="bairro" value="{{profissional.bairro}}" required id="bairro">

    <label for="cidade">Cidade:</label>
    <input type="text" name="cidade" value="{{profissional.cidade}}" required id="cidade">

    <label for="estado">Estado:</label>
    <input type="text" name="estado" value="{{profissional.estado}}" required id="estado" readonly>

    <label for="numero">Número:</label>
    <input type="text" name="numero" value="{{profissional.numero}}" required>

    <label for="telefone">Telefone:</label>
    <input type="text" name="telefone" value="{{profissional.telefone}}" required pattern="\d{10,11}" title="Deve conter 10 ou 11 dígitos">

    <label for="usuario">Usuário:</label>
    <input type="text" name="usuario" value="{{profissional.usuario}}" required>

    <button type="submit">Atualizar Profissional</button>
</form>

<script>
document.getElementById('cep').addEventListener('blur', async function() {
    const cep = this.value.replace(/\D/g, ''); // Remove caracteres não numéricos
    if (cep.length === 8) {
        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const data = await response.json();
            if (!data.erro) {
                document.getElementById('endereco').value = data.logradouro;
                document.getElementById('bairro').value = data.bairro;
                document.getElementById('cidade').value = data.localidade;
                // Preenchendo automaticamente o estado
                document.getElementById('estado').value = data.uf; // Preenche o campo estado
            } else {
                alert('CEP não encontrado.');
            }
        } catch (error) {
            alert('Erro ao buscar endereço. Tente novamente.');
        }
    } else {
        alert('CEP deve conter 8 dígitos.');
    }
});
</script>
