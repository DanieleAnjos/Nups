<!-- Adicione o CSS do Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet">

<div class="container">
  <div class="card shadow-lg p-4">
    <h1 class="text-center text-primary mb-4">Cadastrar Atendimento</h1>

    <form action="/atendimentos" method="POST">
      <!-- Campo oculto para o ID do paciente -->
      <input type="hidden" name="pacienteId" id="pacienteId">

      <!-- Nome do Paciente (Dropdown com busca) -->
      <div class="mb-3">
        <label for="nomePaciente" class="form-label fw-semibold">Nome do Paciente:</label>
        <select name="nomePaciente" id="nomePaciente" class="form-select select2">
          <option value="">Digite para buscar um paciente</option>
          {{#each pacientes}}
            <option value="{{this.id}}" data-matricula="{{this.matricula}}">{{this.nome}}</option>
          {{/each}}
        </select>
      </div>

      <!-- Matrícula do Paciente -->
      <div class="mb-3">
        <label for="matriculaPaciente" class="form-label fw-semibold">Matrícula do Paciente:</label>
        <input type="text" name="matriculaPaciente" id="matriculaPaciente" class="form-control bg-light" readonly>
      </div>

      <!-- Assunto do Atendimento -->
      <div class="mb-3">
        <label for="assuntoAtendimento" class="form-label fw-semibold">Assunto do Atendimento:</label>
        <input type="text" name="assuntoAtendimento" id="assuntoAtendimento" class="form-control" required>
      </div>


      <!-- Registro do Atendimento -->
      <div class="mb-3">
        <label for="registroAtendimento" class="form-label fw-semibold">Registro do Atendimento:</label>
        <textarea name="registroAtendimento" id="registroAtendimento" class="form-control" rows="4" required></textarea>
      </div>

      <!-- Botão de Envio -->
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-success btn-lg px-5">
          <i class="bi bi-check-circle"></i> Cadastrar Atendimento
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Adicione o JS do Select2 e Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
  $(document).ready(function() {
    // Inicializa o Select2 para permitir busca dentro do select
    $('#nomePaciente').select2({
      placeholder: "Digite para buscar um paciente",
      allowClear: true,
      width: '100%'
    });

    // Preenche a matrícula do paciente quando selecionado
    $('#nomePaciente').on('change', function() {
      const selectedOption = $(this).find(':selected');
      $('#matriculaPaciente').val(selectedOption.data('matricula') || '');
      $('#pacienteId').val(selectedOption.val() || '');
    });
  });
</script>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Arial', sans-serif;
    background-color: #f8f9fa;
  }

  .container {
    max-width: 600px;
    margin-top: 40px;
  }

  .card {
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    padding: 20px;
  }

  .form-label {
    font-weight: 600;
  }

  .btn-success {
    background-color: #28a745;
    border-color: #28a745;
    border-radius: 6px;
    transition: 0.3s;
  }

  .btn-success:hover {
    background-color: #218838;
    border-color: #1e7e34;
  }

  .select2-container--default .select2-selection--single {
    height: 38px;
    border-radius: 6px;
  }
</style>
